import os
import json
import random
from datetime import datetime
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes

# –¢–í–û–ô –¢–û–ö–ï–ù –ü–†–Ø–ú–û –í –ö–û–î–ï
TOKEN = "8215171014:AAG-oaPwDp8Mmjv0NdHK2tQUI1kCfYIi9n4"

users_db = {}

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.effective_user
    uid = str(user.id)
    
    if uid not in users_db:
        users_db[uid] = {"balance": 5000, "games": 0, "wins": 0, "name": user.first_name}
    
    text = f"""
üé∞ *–ö–ê–ó–ò–ù–û –ë–û–¢*

–ü—Ä–∏–≤–µ—Ç, {user.first_name}!
–ë–∞–ª–∞–Ω—Å: {users_db[uid]['balance']}‚Çø
–ò–≥—Ä: {users_db[uid]['games']}

–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É –∏–≥—Ä–∞—Ç—å!
"""
    
    keyboard = [[InlineKeyboardButton("üé∞ –ö–†–£–¢–ò–¢–¨ (100‚Çø)", callback_data="spin")]]
    await update.message.reply_text(text, parse_mode='Markdown', reply_markup=InlineKeyboardMarkup(keyboard))

async def spin(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = str(query.from_user.id)
    
    if user_id not in users_db:
        users_db[user_id] = {"balance": 5000, "games": 0, "wins": 0}
    
    user = users_db[user_id]
    
    if user["balance"] < 100:
        await query.message.edit_text("‚ùå –ù—É–∂–Ω–æ 100‚Çø! /start")
        return
    
    user["balance"] -= 100
    user["games"] += 1
    
    symbols = ["üçí", "üçã", "7Ô∏è‚É£"]
    result = [random.choice(symbols) for _ in range(3)]
    
    if result[0] == result[1] == result[2]:
        win = 500
        text = "üé∞ –î–ñ–ï–ö–ü–û–¢!"
        user["wins"] += 1
    elif result[0] == result[1]:
        win = 200
        text = "üéâ –í–´–ò–ì–†–´–®!"
        user["wins"] += 1
    else:
        win = 0
        text = "üò¢ –ü–†–û–ò–ì–†–´–®"
    
    if win > 0:
        user["balance"] += win
    
    msg = f"""
{' | '.join(result)}

{text}

–í—ã–∏–≥—Ä—ã—à: {win}‚Çø
–ë–∞–ª–∞–Ω—Å: {user['balance']}‚Çø
"""
    
    keyboard = [[InlineKeyboardButton("üé∞ –ö–†–£–¢–ò–¢–¨ –ï–©–ï", callback_data="spin")]]
    await query.message.edit_text(msg, reply_markup=InlineKeyboardMarkup(keyboard))

def main():
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
    app = Application.builder().token(TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CallbackQueryHandler(spin))
    print("‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
    app.run_polling()

if __name__ == "__main__":
    main()