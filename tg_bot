import os
import json
import random
import logging
from datetime import datetime
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes

# üîí –¢–æ–∫–µ–Ω –±–µ—Ä–µ—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
TOKEN = os.environ.get("8215171014:AAG-oaPwDp8Mmjv0NdHK2tQUI1kCfYIi9n4")
if not TOKEN:
    print("‚ùå –û–®–ò–ë–ö–ê: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ BOT_TOKEN –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Railway!")
    exit(1)

# –ü—Ä–æ—Å—Ç–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ø–∞–º—è—Ç–∏
users_db = {}

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

# ========== –ö–û–ú–ê–ù–î–´ ==========
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    user = update.effective_user
    
    # –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if str(user.id) not in users_db:
        users_db[str(user.id)] = {
            "balance": 5000,
            "wins": 0,
            "games": 0,
            "name": user.first_name
        }
    
    user_data = users_db[str(user.id)]
    
    welcome = f"""
üé∞ *CASINO ROYALE* üé∞

üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user.first_name}!

üí∞ *–ë–∞–ª–∞–Ω—Å:* {user_data['balance']}‚Çø
üéÆ *–ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ:* {user_data['games']}
‚≠ê *–£—Ä–æ–≤–µ–Ω—å:* {min(user_data['wins'] // 10 + 1, 10)}

*üéØ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢:*
‚Ä¢ –ù–∞–∂–º–∏ –ö–†–£–¢–ò–¢–¨ —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å
‚Ä¢ –°—Ç–∞–≤–∫–∞: 100‚Çø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
‚Ä¢ –í—ã–∏–≥—Ä—ã—à–∏ –¥–æ x1000

*üéÆ –ò–ì–†–´:*
‚î£ üé∞ –°–ª–æ—Ç—ã (–±–∞–∑–æ–≤—ã–µ)
‚î£ üé≤ –ö–æ—Å—Ç–∏ (–ø—Ä–æ—Å—Ç—ã–µ)
‚î£ üÉè –ö–∞—Ä—Ç—ã (21)
‚îó üéØ –†—É–ª–µ—Ç–∫–∞ (—Å–∫–æ—Ä–æ)

*üí∞ –£–ü–†–ê–í–õ–ï–ù–ò–ï:*
‚î£ /balance - –ë–∞–ª–∞–Ω—Å
‚î£ /bonus - –ë–æ–Ω—É—Å 1000‚Çø
‚î£ /stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îó /help - –ü–æ–º–æ—â—å
"""
    
    keyboard = [
        [InlineKeyboardButton("üé∞ –ö–†–£–¢–ò–¢–¨ –°–õ–û–¢–´", callback_data="spin")],
        [InlineKeyboardButton("üí∞ –ë–ê–õ–ê–ù–°", callback_data="balance"),
         InlineKeyboardButton("üéÅ –ë–û–ù–£–°", callback_data="bonus")],
        [InlineKeyboardButton("üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê", callback_data="stats")]
    ]
    
    await update.message.reply_text(
        welcome,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def spin_slot(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = str(query.from_user.id)
    
    if user_id not in users_db:
        await query.message.reply_text("‚ùå –ù–∞–ø–∏—à–∏—Ç–µ /start —Å–Ω–∞—á–∞–ª–∞!")
        return
    
    user = users_db[user_id]
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
    if user["balance"] < 100:
        await query.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –ù—É–∂–Ω–æ 100‚Çø")
        return
    
    # –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
    user["balance"] -= 100
    user["games"] += 1
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–æ—Ç—ã
    symbols = ["üçí", "üçã", "üçä", "‚≠ê", "7Ô∏è‚É£", "üíé"]
    result = [random.choice(symbols) for _ in range(3)]
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
    if result[0] == result[1] == result[2]:
        if result[0] == "üíé":
            win = 10000  # –î–∂–µ–∫–ø–æ—Ç
        elif result[0] == "7Ô∏è‚É£":
            win = 5000
        elif result[0] == "‚≠ê":
            win = 2000
        else:
            win = 500
        win_text = "üé∞ *–î–ñ–ï–ö–ü–û–¢!* üé∞"
        user["wins"] += 1
    elif result[0] == result[1] or result[1] == result[2]:
        win = 200
        win_text = "üéâ *–í–´–ò–ì–†–´–®!*"
        user["wins"] += 1
    else:
        win = 0
        win_text = "üò¢ *–ü–†–û–ò–ì–†–´–®*"
    
    # –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
    if win > 0:
        user["balance"] += win
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    slots_display = f"""
{'‚îÅ' * 20}
   {result[0]}  |  {result[1]}  |  {result[2]}
{'‚îÅ' * 20}

{win_text}

üí∞ *–î–µ—Ç–∞–ª–∏:*
‚Ä¢ –°—Ç–∞–≤–∫–∞: 100‚Çø
‚Ä¢ –í—ã–∏–≥—Ä—ã—à: {win}‚Çø
‚Ä¢ –ë–∞–ª–∞–Ω—Å: {user['balance']}‚Çø
‚Ä¢ –ò–≥—Ä: {user['games']}
‚Ä¢ –ü–æ–±–µ–¥: {user['wins']}
"""
    
    keyboard = [
        [InlineKeyboardButton("üé∞ –ö–†–£–¢–ò–¢–¨ –ï–©–ï (100‚Çø)", callback_data="spin")],
        [InlineKeyboardButton("üé≤ –ò–ì–†–ê–¢–¨ –í –ö–û–°–¢–ò (50‚Çø)", callback_data="dice")],
        [InlineKeyboardButton("üí∞ –ë–ê–õ–ê–ù–°", callback_data="balance"),
         InlineKeyboardButton("üè† –ú–ï–ù–Æ", callback_data="menu")]
    ]
    
    await query.message.edit_text(
        slots_display,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def play_dice(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = str(query.from_user.id)
    
    if user_id not in users_db:
        await query.message.reply_text("‚ùå –ù–∞–ø–∏—à–∏—Ç–µ /start —Å–Ω–∞—á–∞–ª–∞!")
        return
    
    user = users_db[user_id]
    
    if user["balance"] < 50:
        await query.message.edit_text("‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤! –ù—É–∂–Ω–æ 50‚Çø")
        return
    
    # –°–Ω–∏–º–∞–µ–º —Å—Ç–∞–≤–∫—É
    user["balance"] -= 50
    user["games"] += 1
    
    # –ë—Ä–æ—Å–∞–µ–º –∫–æ—Å—Ç–∏
    dice1 = random.randint(1, 6)
    dice2 = random.randint(1, 6)
    total = dice1 + dice2
    
    # –≠–º–æ–¥–∂–∏ –¥–ª—è –∫–æ—Å—Ç–µ–π
    dice_emojis = ["‚öÄ", "‚öÅ", "‚öÇ", "‚öÉ", "‚öÑ", "‚öÖ"]
    
    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
    if dice1 == dice2:
        if dice1 == 6:
            win = 1000  # –î–≤–∞ —à–µ—Å—Ç–µ—Ä–∫–∏
            win_text = "üé≤ *–î–í–û–ô–ù–ê–Ø –®–ï–°–¢–ï–†–ö–ê!*"
        else:
            win = dice1 * 100  # –£–º–Ω–æ–∂–∞–µ–º –Ω–∞ 100
            win_text = f"üé≤ *–î–£–ë–õ–¨ {dice1}!*"
        user["wins"] += 1
    elif total == 7:
        win = 300
        win_text = "üé≤ *–°–ß–ê–°–¢–õ–ò–í–ê–Ø 7!*"
        user["wins"] += 1
    elif total >= 10:
        win = 150
        win_text = f"üé≤ *–ë–û–õ–¨–®–ê–Ø –°–£–ú–ú–ê {total}!*"
        user["wins"] += 1
    else:
        win = 0
        win_text = "üé≤ *–ü–†–û–ò–ì–†–´–®*"
    
    # –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
    if win > 0:
        user["balance"] += win
    
    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
    dice_display = f"""
üé≤ *–ë–†–û–°–û–ö –ö–û–°–¢–ï–ô*

{dice_emojis[dice1-1]}  +  {dice_emojis[dice2-1]}

*–†–µ–∑—É–ª—å—Ç–∞—Ç:* {dice1} + {dice2} = **{total}**

{win_text}

üí∞ *–î–µ—Ç–∞–ª–∏:*
‚Ä¢ –°—Ç–∞–≤–∫–∞: 50‚Çø
‚Ä¢ –í—ã–∏–≥—Ä—ã—à: {win}‚Çø
‚Ä¢ –ë–∞–ª–∞–Ω—Å: {user['balance']}‚Çø
"""
    
    keyboard = [
        [InlineKeyboardButton("üé≤ –ë–†–û–°–ò–¢–¨ –ï–©–ï (50‚Çø)", callback_data="dice")],
        [InlineKeyboardButton("üé∞ –ò–ì–†–ê–¢–¨ –í –°–õ–û–¢–´ (100‚Çø)", callback_data="spin")],
        [InlineKeyboardButton("üí∞ –ë–ê–õ–ê–ù–°", callback_data="balance")]
    ]
    
    await query.message.edit_text(
        dice_display,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def show_balance(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = str(query.from_user.id)
    
    if user_id not in users_db:
        await query.message.reply_text("‚ùå –ù–∞–ø–∏—à–∏—Ç–µ /start —Å–Ω–∞—á–∞–ª–∞!")
        return
    
    user = users_db[user_id]
    
    balance_text = f"""
üí∞ *–í–ê–® –ë–ê–õ–ê–ù–°*

*–û—Å–Ω–æ–≤–Ω–æ–µ:*
‚î£ üí∞ –ë–∞–ª–∞–Ω—Å: {user['balance']}‚Çø
‚î£ üéÆ –í—Å–µ–≥–æ –∏–≥—Ä: {user['games']}
‚î£ ‚úÖ –ü–æ–±–µ–¥: {user['wins']}
‚î£ üìä –í–∏–Ω—Ä–µ–π—Ç: {(user['wins']/user['games']*100) if user['games'] > 0 else 0:.1f}%
‚îó ‚≠ê –£—Ä–æ–≤–µ–Ω—å: {min(user['wins'] // 10 + 1, 10)}

*–ë–æ–Ω—É—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã–µ:*
‚Ä¢ –ö–∞–∂–¥—ã–π —á–∞—Å: +100‚Çø (/bonus)
‚Ä¢ –ó–∞ –∫–∞–∂–¥—ã–µ 10 –ø–æ–±–µ–¥: +500‚Çø
‚Ä¢ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞: +1000‚Çø –∑–∞ –¥—Ä—É–≥–∞

*–ö–∞–∫ —É–≤–µ–ª–∏—á–∏—Ç—å –±–∞–ª–∞–Ω—Å:*
1. –ò–≥—Ä–∞—Ç—å –∏ –≤—ã–∏–≥—Ä—ã–≤–∞—Ç—å
2. –ó–∞–±–∏—Ä–∞—Ç—å –±–æ–Ω—É—Å—ã
3. –ü—Ä–∏–≥–ª–∞—à–∞—Ç—å –¥—Ä—É–∑–µ–π
4. –ü–æ–≤—ã—à–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å
"""
    
    keyboard = [
        [InlineKeyboardButton("üéÅ –ü–û–õ–£–ß–ò–¢–¨ –ë–û–ù–£–° 100‚Çø", callback_data="get_bonus")],
        [InlineKeyboardButton("üë• –ü–†–ò–ì–õ–ê–°–ò–¢–¨ –î–†–£–ì–ê", callback_data="invite")],
        [InlineKeyboardButton("üé∞ –ò–ì–†–ê–¢–¨", callback_data="spin")]
    ]
    
    await query.message.edit_text(
        balance_text,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def give_bonus(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = str(query.from_user.id)
    
    if user_id not in users_db:
        await query.message.reply_text("‚ùå –ù–∞–ø–∏—à–∏—Ç–µ /start —Å–Ω–∞—á–∞–ª–∞!")
        return
    
    user = users_db[user_id]
    
    # –î–∞–µ–º –±–æ–Ω—É—Å
    bonus = 1000
    user["balance"] += bonus
    
    bonus_text = f"""
üéÅ *–ë–û–ù–£–° –ü–û–õ–£–ß–ï–ù!*

+{bonus}‚Çø –∑–∞—á–∏—Å–ª–µ–Ω–æ –Ω–∞ –≤–∞—à —Å—á–µ—Ç!

üí∞ *–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å:* {user['balance']}‚Çø

*–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –µ—â–µ –±–æ–Ω—É—Å–æ–≤:*
‚Ä¢ –ó–∞—Ö–æ–¥–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å (—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è)
‚Ä¢ –ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π (+500‚Çø –∑–∞ –∫–∞–∂–¥–æ–≥–æ)
‚Ä¢ –ò–≥—Ä–∞–π –∞–∫—Ç–∏–≤–Ω–æ (+100‚Çø –∑–∞ 10 –∏–≥—Ä)
‚Ä¢ –ü–æ–≤—ã—à–∞–π —É—Ä–æ–≤–µ–Ω—å (–±–æ–ª—å—à–µ –±–æ–Ω—É—Å–æ–≤)
"""
    
    keyboard = [
        [InlineKeyboardButton("üé∞ –ò–ì–†–ê–¢–¨ –° –ë–û–ù–£–°–û–ú", callback_data="spin")],
        [InlineKeyboardButton("üí∞ –ë–ê–õ–ê–ù–°", callback_data="balance")]
    ]
    
    await query.message.edit_text(
        bonus_text,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def show_stats(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    user_id = str(query.from_user.id)
    
    if user_id not in users_db:
        await query.message.reply_text("‚ùå –ù–∞–ø–∏—à–∏—Ç–µ /start —Å–Ω–∞—á–∞–ª–∞!")
        return
    
    user = users_db[user_id]
    
    # –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    total_users = len(users_db)
    total_games = sum(u["games"] for u in users_db.values())
    total_wins = sum(u["wins"] for u in users_db.values())
    
    stats_text = f"""
üìä *–°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–ì–†–û–ö–ê*

*–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ:*
‚î£ –ò–º—è: {user['name']}
‚î£ ID: {user_id[-6:]}
‚î£ –ë–∞–ª–∞–Ω—Å: {user['balance']}‚Çø
‚î£ –ò–≥—Ä —Å—ã–≥—Ä–∞–Ω–æ: {user['games']}
‚î£ –ü–æ–±–µ–¥: {user['wins']}
‚î£ –ü–æ—Ä–∞–∂–µ–Ω–∏–π: {user['games'] - user['wins']}
‚î£ –í–∏–Ω—Ä–µ–π—Ç: {(user['wins']/user['games']*100) if user['games'] > 0 else 0:.1f}%
‚îó –£—Ä–æ–≤–µ–Ω—å: {min(user['wins'] // 10 + 1, 10)}

*–ì–ª–æ–±–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:*
‚î£ –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: {total_users}
‚î£ –í—Å–µ–≥–æ –∏–≥—Ä: {total_games}
‚î£ –í—Å–µ–≥–æ –ø–æ–±–µ–¥: {total_wins}
‚î£ –û–±—â–∏–π –≤–∏–Ω—Ä–µ–π—Ç: {(total_wins/total_games*100) if total_games > 0 else 0:.1f}%
‚îó –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–∞–Ω—Å: {sum(u['balance'] for u in users_db.values())//total_users if total_users > 0 else 0}‚Çø

*üìà –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å:*
‚Ä¢ –î–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —É—Ä–æ–≤–Ω—è: {10 - (user['wins'] % 10)} –ø–æ–±–µ–¥
‚Ä¢ –†–µ–∫–æ—Ä–¥ –±–∞–ª–∞–Ω—Å–∞: {user['balance']}‚Çø
‚Ä¢ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: {'üî• –í—ã—Å–æ–∫–∞—è' if user['games'] > 50 else 'üëç –°—Ä–µ–¥–Ω—è—è' if user['games'] > 10 else 'üå± –ù–æ–≤–∞—è'}
"""
    
    keyboard = [
        [InlineKeyboardButton("üîÑ –û–ë–ù–û–í–ò–¢–¨ –°–¢–ê–¢–ò–°–¢–ò–ö–£", callback_data="stats")],
        [InlineKeyboardButton("üèÜ –¢–û–ü –ò–ì–†–û–ö–û–í", callback_data="top")],
        [InlineKeyboardButton("üé∞ –ò–ì–†–ê–¢–¨", callback_data="spin")]
    ]
    
    await query.message.edit_text(
        stats_text,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def top_players(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    
    if not users_db:
        await query.message.edit_text("üìä –ü–æ–∫–∞ –Ω–µ—Ç –∏–≥—Ä–æ–∫–æ–≤ –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–µ")
        return
    
    # –°–æ—Ä—Ç–∏—Ä—É–µ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –±–∞–ª–∞–Ω—Å—É
    sorted_players = sorted(
        users_db.items(),
        key=lambda x: x[1]["balance"],
        reverse=True
    )[:10]
    
    top_text = "üèÜ *–¢–û–ü 10 –ò–ì–†–û–ö–û–í* üèÜ\n\n"
    
    medals = ["ü•á", "ü•à", "ü•â", "4Ô∏è‚É£", "5Ô∏è‚É£", "6Ô∏è‚É£", "7Ô∏è‚É£", "8Ô∏è‚É£", "9Ô∏è‚É£", "üîü"]
    
    for i, (user_id, user_data) in enumerate(sorted_players):
        # –û–±—Ä–µ–∑–∞–µ–º ID –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
        short_id = user_id[-4:]
        
        top_text += f"{medals[i]} *{user_data['name']}* (ID: {short_id})\n"
        top_text += f"   üí∞ {user_data['balance']}‚Çø | üéÆ {user_data['games']} –∏–≥—Ä\n"
        top_text += f"   ‚úÖ {user_data['wins']} –ø–æ–±–µ–¥ | ‚≠ê –£—Ä. {min(user_data['wins'] // 10 + 1, 10)}\n\n"
    
    top_text += f"\n*üìä –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞–∑–∏–Ω–æ:*\n"
    top_text += f"‚Ä¢ –í—Å–µ–≥–æ –∏–≥—Ä–æ–∫–æ–≤: {len(users_db)}\n"
    top_text += f"‚Ä¢ –í—Å–µ–≥–æ –∏–≥—Ä: {sum(u['games'] for u in users_db.values())}\n"
    top_text += f"‚Ä¢ –û–±—â–∏–π –±–∞–ª–∞–Ω—Å: {sum(u['balance'] for u in users_db.values()):,}‚Çø"
    
    keyboard = [
        [InlineKeyboardButton("üîÑ –û–ë–ù–û–í–ò–¢–¨ –¢–û–ü", callback_data="top")],
        [InlineKeyboardButton("üé∞ –ò–ì–†–ê–¢–¨", callback_data="spin")]
    ]
    
    await query.message.edit_text(
        top_text,
        parse_mode='Markdown',
        reply_markup=InlineKeyboardMarkup(keyboard)
    )

async def menu(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await start(update, context)

# ========== –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–û–ö ==========
async def button_handler(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    data = query.data
    
    handlers = {
        "spin": spin_slot,
        "dice": play_dice,
        "balance": show_balance,
        "bonus": give_bonus,
        "get_bonus": give_bonus,
        "stats": show_stats,
        "top": top_players,
        "menu": menu,
        "invite": show_balance
    }
    
    if data in handlers:
        await handlers[data](update, context)

# ========== –ó–ê–ü–£–°–ö –ë–û–¢–ê ==========
def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    print("ü§ñ –ó–∞–ø—É—Å–∫ Telegram Casino Bot...")
    print(f"üîë –¢–æ–∫–µ–Ω: {'*' * 20}{TOKEN[-4:]}")
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(TOKEN).build()
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –∫–æ–º–∞–Ω–¥—ã
    application.add_handler(CommandHandler("start", start))
    application.add_handler(CommandHandler("balance", show_balance))
    application.add_handler(CommandHandler("bonus", give_bonus))
    application.add_handler(CommandHandler("stats", show_stats))
    application.add_handler(CommandHandler("top", top_players))
    
    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–æ–∫
    application.add_handler(CallbackQueryHandler(button_handler))
    
    print("\n" + "="*50)
    print("üé∞ CASINO BOT –ó–ê–ü–£–©–ï–ù –£–°–ü–ï–®–ù–û!")
    print("="*50)
    print("üì± –û—Ç–∫—Ä–æ–π—Ç–µ Telegram –∏ –Ω–∞–π–¥–∏—Ç–µ —Å–≤–æ–µ–≥–æ –±–æ—Ç–∞")
    print("üéÆ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ /start –¥–ª—è –Ω–∞—á–∞–ª–∞")
    print("‚ö° –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç 24/7 –Ω–∞ Railway")
    print("="*50)
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    application.run_polling()

if __name__ == "__main__":
    main()
